<!--
Copyright 2012 Hans Beemsterboer

This file is part of the TechyTax program.

TechyTax is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 3 of the License, or
(at your option) any later version.

TechyTax is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with TechyTax; if not, write to the Free Software
Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
-->
<!DOCTYPE sqlMap 
          PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" 
          "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="Kost">
	<typeAlias alias="cost" type="org.techytax.domain.Cost" />
	<typeAlias alias="key" type="org.techytax.domain.KeyId" />	
	<parameterMap id="periodeMap" class="java.util.Map">
		<parameter property="beginDatum" javaType="string" />
		<parameter property="eindDatum" javaType="string" />
		<parameter property="userId" javaType="string" />
	</parameterMap>

	<select id="getKostLijst" parameterClass="string"
		resultClass="cost">
		SELECT k.id, bedrag as amount, datum as date, btw as vat, k.omschrijving as description, ks.id as costTypeId, ks.omschrijving as kostenSoortOmschrijving 
		FROM kosten	k, kostensoort ks 
		WHERE k.kostensoort_id = ks.id 
		AND datum &lt;= CURDATE()
		AND user_id = #value# 
		ORDER BY datum DESC
		LIMIT 10
	</select>
	<select id="getCompleteKostLijst" parameterMap="periodeMap"
		resultClass="cost">
		SELECT k.id, bedrag as amount, datum as date, btw as vat, k.omschrijving as description, ks.id as costTypeId, ks.omschrijving as kostenSoortOmschrijving 
		FROM kosten k, kostensoort ks 
		WHERE k.kostensoort_id = ks.id 
		AND	datum &gt;= ? 
		AND datum &lt;= ? 
		AND user_id = ?
		ORDER BY datum asc
	</select>	
	<select id="getBtwBalansLijst" parameterMap="periodeMap"
		resultClass="cost">
		SELECT k.id, bedrag as amount, datum as date, btw as vat, k.omschrijving as description, ks.id as costTypeId, ks.omschrijving as kostenSoortOmschrijving 
		FROM kosten k, kostensoort ks 
		WHERE k.kostensoort_id = ks.id 
		AND	datum &gt;= ? 
		AND datum &lt;= ? 
		AND ks.id IN (select id from kostensoort where btwVerrekenbaar = 1)
		AND btw != 0
		AND user_id = ?
		ORDER BY datum asc
	</select>
	<select id="getRekeningBalansLijst" parameterMap="periodeMap"
		resultClass="cost">
		SELECT k.id, bedrag, bedrag as amount, datum as date, btw as vat, k.omschrijving as description, ks.id as costTypeId, ks.omschrijving as kostenSoortOmschrijving 
		FROM kosten k, kostensoort ks 
		WHERE k.kostensoort_id = ks.id 
		AND	datum &gt;= ? 
		AND datum &lt;= ? 
		AND ks.id IN (select id from kostensoort where balansmeetellen = 1) 
		AND user_id = ?
		ORDER BY datum asc
	</select>
	<select id="getKostenBalansLijst" parameterMap="periodeMap"
		resultClass="cost">
		SELECT k.id, bedrag as amount, datum as date, btw as vat, k.omschrijving as description, ks.id as costTypeId, ks.omschrijving as kostenSoortOmschrijving 
		FROM kosten k, kostensoort ks
		WHERE k.kostensoort_id = ks.id 
		AND	datum &gt;= ? 
		AND datum &lt;= ? 
		AND ks.id IN (1,2,3,7,8,9,13,14,19,20,27,28,31,32)
		AND user_id = ?
		ORDER BY datum asc
	</select>	
	<select id="getKostenBalansCurrentAccountLijst" parameterMap="periodeMap"
		resultClass="cost">
		SELECT k.id, bedrag as amount, datum as date, btw as vat, k.omschrijving as description, ks.id as costTypeId, ks.omschrijving as kostenSoortOmschrijving 
		FROM kosten k, kostensoort ks
		WHERE k.kostensoort_id = ks.id 
		AND	datum &gt;= ? 
		AND datum &lt;= ? 
		AND ks.id IN (2,3,9,13,14,16,27,28,31,41)
		AND user_id = ?
		ORDER BY datum asc
	</select>
	<select id="getReisKostenBalansLijst" parameterMap="periodeMap"
		resultClass="cost">
		SELECT k.id, bedrag as amount, datum as date, btw as vat, k.omschrijving as description, ks.id as costTypeId, ks.omschrijving as kostenSoortOmschrijving 
		FROM kosten k, kostensoort ks 
		WHERE k.kostensoort_id = ks.id 
		AND	datum &gt;= ? 
		AND datum &lt;= ? 
		AND ks.id IN (8,9,14,19,31,36) 
		AND user_id = ?
		ORDER BY datum asc
	</select>
	<select id="getInvesteringenLijst" parameterMap="periodeMap"
		resultClass="cost">
		SELECT k.id, bedrag as amount, datum as date, btw as vat, k.omschrijving as description, ks.id as costTypeId, ks.omschrijving as kostenSoortOmschrijving 
		FROM kosten k, kostensoort ks 
		WHERE k.kostensoort_id = ks.id 
		AND datum &gt;= ? 
		AND datum &lt;= ? 
		AND ks.id NOT IN (1,4,5,10,12,14,15,17,23,24,25,29,30,33,38,39) 
		AND user_id = ?
		ORDER BY datum asc
	</select>
	<select id="getAfschrijvingenLijst" parameterMap="periodeMap"
		resultClass="cost">
		SELECT k.id, bedrag as amount, datum as date, btw as vat, k.omschrijving as description, ks.id as costTypeId, ks.omschrijving as kostenSoortOmschrijving 
		FROM kosten k, kostensoort ks 
		WHERE k.kostensoort_id = ks.id 
		AND datum &gt;= ? 
		AND datum &lt;= ? 
		AND ks.id IN (23,25)
		AND user_id = ? 
		ORDER BY datum asc
	</select>
	<select id="getPrivateExpenses" parameterMap="periodeMap"
		resultClass="cost">
		SELECT id, amount, is_incoming as isIncoming, datum as date, description 
		FROM private_expenses 
		WHERE datum &gt;= ? 
		AND datum &lt;= ? 
		AND user_id = ?
		ORDER BY
		datum asc
	</select>
	<select id="getTaxList" parameterMap="periodeMap"
		resultClass="cost">
		SELECT k.id, bedrag as amount, datum as date, btw as vat, k.omschrijving as description, ks.id as costTypeId, ks.omschrijving as kostenSoortOmschrijving 
		FROM kosten k, kostensoort ks 
		WHERE k.kostensoort_id = ks.id 
		AND datum &gt;= ? 
		AND datum &lt;= ? 
		AND ks.id IN (12,29,30,31,34)
		AND user_id = ?
		ORDER BY datum asc
	</select>	
	<select id="getVatCorrectionDepreciation" parameterMap="periodeMap"
		resultClass="cost">
		SELECT k.id, bedrag as amount, datum as date, btw as vat, k.omschrijving as description, ks.id as costTypeId, ks.omschrijving as kostenSoortOmschrijving 
		FROM kosten k, kostensoort ks 
		WHERE k.kostensoort_id = ks.id 
		AND	datum &gt;= ? 
		AND datum &lt;= ? 
		AND ks.id IN (35)
		AND user_id = ? 
		ORDER BY datum asc
	</select>
	<select id="getAuditList" parameterMap="periodeMap"
		resultClass="cost">
		SELECT k.id, bedrag as amount, datum as date, btw as vat, k.omschrijving as description, ks.id as costTypeId, ks.omschrijving as kostenSoortOmschrijving 
		FROM kosten k, kostensoort ks 
		WHERE k.kostensoort_id = ks.id 
		AND	datum &gt;= ? 
		AND datum &lt;= ? 
		AND user_id = ?
		ORDER BY ks.id asc
	</select>	
	<insert id="insertKost" parameterClass="cost">
		insert into kosten
		values(#id#,#userId#,#amount#,#date#,#description#,#vat#,#costTypeId#)
		<selectKey resultClass="int" keyProperty="id">
			SELECT @@IDENTITY AS ID
		</selectKey>
	</insert>
	<insert id="insertPrivateExpense" parameterClass="cost">
		insert into private_expenses
		values(#id#,#userId#,#amount#,#isIncoming#,#date#,#description#)
		<selectKey resultClass="int" keyProperty="id">
			SELECT @@IDENTITY AS ID
		</selectKey>
	</insert>	
	<select id="getKost" parameterClass="key" resultClass="cost">
		SELECT k.id, bedrag as amount, datum as date, btw as vat, k.omschrijving as description, ks.id as costTypeId 
		FROM kosten k, kostensoort ks 
		WHERE k.id = #id#
		AND k.kostensoort_id = ks.id
		AND user_id = #userId#
	</select>
	<update id="updateKost" parameterClass="cost">
		update kosten set bedrag = #amount#, btw = #vat#, datum = #date#, omschrijving = #description#, kostensoort_id = #costTypeId# 
		WHERE id = #id# 
		AND user_id = #userId#
	</update>
	<select id="getAllCosts" parameterClass="string"
		resultClass="cost">
		SELECT id, bedrag as amount, datum as date, btw as vat, omschrijving as description, kostensoort_id as costTypeId  
		FROM kosten 
	</select>
	<select id="getAllCostsForUser" parameterClass="string"
		resultClass="cost">
		SELECT k.id, bedrag as amount, datum as date, btw as vat, k.omschrijving as description, ks.id as costTypeId, ks.omschrijving as kostenSoortOmschrijving 
		FROM kosten k, kostensoort ks 
		WHERE k.kostensoort_id = ks.id
		AND user_id = #userId#
	</select>
	<select id="getRepurchases" parameterMap="periodeMap"
		resultClass="cost">
		SELECT k.id, bedrag as amount, datum as date, btw as vat, k.omschrijving as description, ks.id as costTypeId, ks.omschrijving as kostenSoortOmschrijving 
		FROM kosten k, kostensoort ks 
		WHERE k.kostensoort_id = ks.id 
		AND	datum &gt;= ? 
		AND datum &lt;= ? 
		AND ks.id = 40
		AND user_id = ? 
		ORDER BY datum asc
	</select>
	<select id="getInterest" parameterMap="periodeMap"
		resultClass="cost">
		SELECT id, bedrag as amount 
		FROM kosten 
		WHERE datum &gt;= ? 
		AND datum &lt;= ? 
		AND kostensoort_id = 33 
		AND user_id = ?
	</select>
	<select id="getInvoices" parameterMap="periodeMap"
		resultClass="cost">
		SELECT id, bedrag as amount, datum as date, btw as vat, omschrijving as description, kostensoort_id as costTypeId 
		FROM kosten
		where kostensoort_id in (38,39) 
		and datum &gt;= ? 
		and datum &lt;= ? 
		and user_id=? 
		order by datum
	</select>
	<select id="getVatDebt" parameterMap="periodeMap"
		resultClass="cost">
		SELECT id, bedrag as amount, datum as date, btw as vat, omschrijving as description, kostensoort_id as costTypeId 
		FROM kosten
		where kostensoort_id = 39 
		and datum &gt;= ? 
		and datum &lt;= ? 
		and user_id=? 
	</select>
	<select id="getCostsWithPrivateMoney" parameterMap="periodeMap" resultClass="cost">
		select id, bedrag as amount, btw as vat 
		from kosten 
		where kostensoort_id in (6,7,8,19,20,21,22,26) 
		and datum &gt;= ? 
		and datum &lt;= ?
		and user_id=?
	</select>
	<delete id="deleteCost" parameterClass="cost">
		delete from kosten
		where id = #id#
		and user_id = #userId#
	</delete>
	<select id="getVatCostsWithPrivateMoney" parameterMap="periodeMap" resultClass="cost">
		SELECT k.id, bedrag as amount, datum as date, btw as vat, k.omschrijving as description, ks.id as costTypeId, ks.omschrijving as kostenSoortOmschrijving 
		FROM kosten k, kostensoort ks 
		WHERE k.kostensoort_id = ks.id 
		and kostensoort_id in (0,7,19,21,26,32) 
		and datum &gt;= ? 
		and datum &lt;= ?
		and user_id=?
	</select>			
</sqlMap>