<!--
Copyright 2013 Hans Beemsterboer

This file is part of the TechyTax program.

TechyTax is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 3 of the License, or
(at your option) any later version.

TechyTax is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with TechyTax; if not, write to the Free Software
Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
-->
<!DOCTYPE sqlMap 
          PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" 
          "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="BookValue">
	<typeAlias alias="bookValue" type="org.techytax.domain.BookValue" />
	<typeAlias alias="remainingValue" type="org.techytax.domain.RemainingValue" />
	<typeAlias alias="key" type="org.techytax.domain.KeyId" />	
	<select id="getVorigeBoekwaarde" parameterClass="bookValue" resultClass="bookValue">
		SELECT id, balans_id as balanceType, boekjaar as jaar, saldo, user_id as userId 
		FROM boekwaarde 
		WHERE balans_id=#balanceType# 
		AND boekjaar=#jaar#-1
		AND user_id=#userId#
	</select>
	<select id="getAllBoekwaardes" resultClass="bookValue">
		SELECT id, balans_id as balanceType, boekjaar as jaar, saldo 
		FROM boekwaarde
	</select>	
	<select id="getBoekwaardeDitJaar" parameterClass="bookValue" resultClass="bookValue">
		SELECT id, balans_id as balanceType, boekjaar as jaar, saldo, user_id as userId 
		FROM boekwaarde 
		WHERE balans_id=#balanceType# 
		AND boekjaar=#jaar#
		AND user_id=#userId#
	</select>	
	<insert id="insertBoekwaarde" parameterClass="bookValue">
		insert into boekwaarde
		values(#id#,#userId#,#balanceType#,#jaar#,#saldo#)
	</insert>
	<update id="updateBoekwaarde" parameterClass="bookValue">
		update boekwaarde set saldo = #saldo#, balans_id = #balanceType#, boekjaar = #jaar#
		where id = #id#
		and user_id = #userId#
	</update>	
	<select id="getAllRestwaardes" resultClass="remainingValue">
		SELECT id, restwaarde 
		FROM restwaarde
	</select>
	<insert id="insertRestwaarde" parameterClass="remainingValue">
		insert into restwaarde
		values(#id#,#userId#,#activaId#,#restwaarde#)
	</insert>	
	<update id="updateRestwaarde" parameterClass="remainingValue">
		update restwaarde set restwaarde = #restwaarde#
		where id = #id#
		and user_id = #userId#
	</update>
	<update id="updateRemainingValueByActivumId" parameterClass="remainingValue">
		update restwaarde set restwaarde = #restwaarde#
		where activa_id = #activaId#
		and user_id = #userId#
	</update>	
	<select id="getBookValues" parameterClass="key" resultClass="bookValue">
		select bw.id, omschrijving as description, boekjaar as jaar, saldo 
		from boekwaarde as bw, balanssoort as bs, balans as b 
		where user_id=#userId# 
		and b.balanssoort_id = bs.id 
		and bw.balans_id = b.id 
		order by boekjaar desc, balans_id asc
	</select>
	<select id="getBookValue" parameterClass="key" resultClass="bookValue">
		select bw.id, omschrijving as description, bs.id as balanceType, boekjaar as jaar, saldo 
		from boekwaarde as bw, balanssoort as bs, balans as b 
		where user_id=#userId# 
		and b.balanssoort_id = bs.id 
		and bw.balans_id = b.id 
		and bw.id = #id#
	</select>			
	<select id="getBookValuesForChart" parameterClass="key" resultClass="bookValue">
		select bw.id, omschrijving as description, boekjaar as jaar, saldo 
		from boekwaarde as bw, balanssoort as bs, balans as b 
		where user_id=#userId# 
		and b.balanssoort_id = bs.id 
		and bw.balans_id = b.id 
		order by balans_id asc, boekjaar asc;
	</select>
	<select id="getRemainingValueForMachines" parameterClass="key" resultClass="remainingValue">
		select restwaarde.id, activa.id as activaId, restwaarde.restwaarde
		from activa, restwaarde , kosten, balans
		where 
		kosten.id = activa.kost_id and
		restwaarde.activa_id = activa.id and
		balans.id = activa.balans_id and
		balans.balanssoort_id = 1 and
		activa.einddatum is null
		and activa.user_id = #userId#
	    and restwaarde.user_id = #userId#
	</select>
	<select id="getBookValuesHistory" parameterClass="key" resultClass="bookValue">
		select bw.id, omschrijving as description, balans_id as balanceType, boekjaar as jaar, saldo 
		from boekwaarde as bw, balanssoort as bs, balans as b
		where user_id=#userId# 
		and b.balanssoort_id = bs.id 
		and bw.balans_id = b.id 
		order by balans_id asc, boekjaar desc;
	</select>
	<delete id="deleteBookValue" parameterClass="key">
		delete from
		boekwaarde
		where user_id = #userId#
		and id = #id#
	</delete>		
</sqlMap>